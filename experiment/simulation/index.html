<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/main.css">
    <title>Spatial Multiplexing Simulation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/virtual-labs/virtual-style@0.0.8-b/css/style.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"></script>
</head>
<body>
    <!-- Add navigation bar -->
    <div style="width: 100%; background-color: #f8f9fa; padding: 15px 0; text-align: center; display: flex; justify-content: center; border-bottom: 2px solid #e0e0e0;">
        <div style="display: flex; gap: 10px;">
            <button id="tab1Btn" class="tab-button active" onclick="showTab('TASK1')" style="padding: 12px 24px; border: 1px solid black; background-color: #98CB3B; color: white; font-weight: 600; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; font-size: 15px;">Spatial Multiplexing</button>
            <button id="tab2Btn" class="tab-button" onclick="showTab('TASK2')" style="padding: 12px 24px; border: 1px solid black; background-color: #e0e0e0; color: #333; font-weight: 600; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; font-size: 15px;">Ergodic Capacity Analysis</button>
        </div>
        <style>
            .tab-button.active {
            background-color: #98CB3B !important;
            color: white !important;
            }
            .tab-button:not(.active) {
            background-color: #e0e0e0 !important;
            color: #333 !important;
            }
        </style>
    </div>
        <section class="fre" id="TASK1">
            <div class="max-width">
                <h2 class="title">Spatial Multiplexing Simulation</h2>
                <div class="columns is-centered">
                    <div class="v-collapsible-instruction-container v-instruction-container">
                        <div class="v-collapsible is-size-5">Instructions</div>
                        <div class="v-content" style="text-align: left; padding-left: 10%; padding-right: 10%;">
                            <ol>
                                <li><strong>Getting Started:</strong> This simulation demonstrates spatial multiplexing in MIMO wireless systems.</li>
                                <li><strong>Simulate Channel:</strong> Click the "Simulate Channel" button to generate a random complex channel matrix between transmit and receive antennas.</li>
                                <li><strong>Analyze Results:</strong> After simulation, examine the complex channel matrix displayed in the output section.</li>
                                <li><strong>Perform SVD:</strong> Click "Perform SVD" to decompose the channel matrix and reveal its eigenbeams (spatial modes).</li>
                                <li><strong>Visualize Eigenbeams:</strong> Click this button to see how the signal propagates through different spatial paths, showing the strength (singular value) and SNR of each path.</li>
                                <li><strong>Interpret Metrics:</strong> The rank indicates the number of usable spatial streams, while total SNR and capacity show key performance metrics.</li>
                                <li><strong>Reset:</strong> Click "Reset" to start over with a new simulation.</li>
                            </ol>
                        </div>
                    </div>
                </div>
                <div class="columns-container">
                    <div class="left-column box">
                        <div id="input-section" class="layout-column">
                            <h3>Controls</h3>
                            <div class="control-group">
                                <label for="txCount">Transmit Antennas (max 6):</label>
                                <input type="number" id="txCount" value="4" min="1" max="6" onchange="validateAntennaCount(this)">
                            </div>
                            <div class="control-group">
                                <label for="rxCount">Receive Antennas (max 6):</label>
                                <input type="number" id="rxCount" value="4" min="1" max="6" onchange="validateAntennaCount(this)">
                            </div>
                            <div class="control-group">
                                <label for="snrInput">Average SNR (dB):</label>
                                <input type="number" id="snrInput" value="10" min="0" max="50" step="1">
                            </div>
                        
                            <div class="error-message" id="errorMessage"></div>
                            <button id="simulateBtn" onclick="simulate()" style="border-radius: 8px;">Simulate Channel</button>
                            <button id="svdBtn" onclick="performSVD()" style="display: none; border-radius: 8px;">Perform SVD</button>
                            <button id="resetBtn" class="accent" onclick="resetSimulation()" style="border-radius: 8px;">Reset</button>
                        </div>
                    </div>
                    <div class="center-column box">
                        
                        <div id="simulation-section" class="layout-column">
                            <div class="simulation-container">
                                <div class="column">
                                    <div class="column-label">Transmitter</div>
                                    <div id="txColumn"></div>
                                </div>
                                <canvas id="signalCanvas"></canvas>
                                <div class="column">
                                    <div class="column-label">Receiver</div>
                                    <div id="rxColumn"></div>
                                </div>
                            </div>
                            <div class="simulation-footer">
                                <div class="info-block" id="analysisInfo" style="display: none;"></div>
                                <button id="eigenbeamBtn" class="accent" onclick="visualizeEigenbeams()" style="display: none; border-radius: 8px;">Visualize Eigenbeams</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="right-column box">
                        <div id="output-section" class="layout-column">
                            <h3>Outputs</h3>
                            <div id="channelMatrixDisplay" class="matrix-display" style="display: none;">
                                <h3>Channel Matrix (H)</h3>
                                <div id="matrixContainer"></div>
                            </div>
                            <div id="svdMatrixDisplay" class="matrix-display" style="display: none;">
                                <h3>Singular Values (Î£)</h3>
                                <div id="sigmaMatrixContainer"></div>
                            </div>
                            <div id="metricsDisplay" class="metrics-display" style="display: none;">
                                <h3>System Performance</h3>
                                <div class="metric-container">
                                    <div class="metric">Rank (R)<span id="rankOutput">-</span></div>
                                    <div class="metric">Sum Capacity<span id="capacityOutput">- bps/Hz</span></div>
                                </div>
                            </div>
                            <div id="streamMetricsDisplay" class="matrix-display" style="display: none;">
                                <h3>Per-Stream Metrics</h3>
                                <div id="streamMetricsContainer"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                
            </div>
            
        </section>

        <section class="fre" id="TASK2" style="display: none;">
            <div class="max-width">
                <h2 class="title">MIMO Ergodic Capacity vs SNR</h2>
                <div class="columns is-centered">
                    <div class="v-collapsible-instruction-container v-instruction-container">
                        <div class="v-collapsible is-size-5">Instructions</div>
                        <div class="v-content" style="text-align: left; padding-left: 10%; padding-right: 10%;">
                            <ol>
                                <li><strong>Getting Started:</strong> This simulation analyzes the ergodic capacity of MIMO systems across different SNR values.</li>
                                <li><strong>Configure Antenna Setup:</strong> Set the number of transmit and receive antennas to define your MIMO configuration.</li>
                                <li><strong>Define SNR Range:</strong> Specify the minimum and maximum SNR values (in dB) and the step size for the analysis range.</li>
                                <li><strong>Set Realizations:</strong> Choose the number of channel realizations (100-10000) to average over for accurate ergodic capacity estimation.</li>
                                <li><strong>Compute Capacity:</strong> Click "Compute Ergodic Capacity" to run the simulation across all SNR points with multiple channel realizations.</li>
                                <li><strong>Analyze Graph:</strong> Examine the resulting plot showing how ergodic capacity (in bps/Hz) increases with SNR for your MIMO configuration.</li>
                                <li><strong>Compare Configurations:</strong> Try different antenna configurations to observe how MIMO diversity affects capacity performance.</li>
                            </ol>
                        </div>
                    </div>
                </div>
                <div class="columns-container">
                    <div class="left-column box">
                        <h3>Parameters</h3>
                        <div class="control-group">
                            <label for="txCountErgodic">Transmit Antennas:</label>
                            <input type="number" id="txCountErgodic" value="4" min="1" max="6">
                        </div>
                        <div class="control-group">
                            <label for="rxCountErgodic">Receive Antennas:</label>
                            <input type="number" id="rxCountErgodic" value="4" min="1" max="6">
                        </div>
                        <div class="control-group">
                            <label for="snrMin">SNR Min (dB):</label>
                            <input type="number" id="snrMin" value="0" min="-10" max="30">
                        </div>
                        <div class="control-group">
                            <label for="snrMax">SNR Max (dB):</label>
                            <input type="number" id="snrMax" value="30" min="0" max="50">
                        </div>
                        <div class="control-group">
                            <label for="snrStep">SNR Step (dB):</label>
                            <input type="number" id="snrStep" value="2" min="0.5" max="5" step="0.5">
                        </div>
                        <div class="control-group">
                            <label for="numRealizations">Number of Realizations:</label>
                            <input type="number" id="numRealizations" value="1000" min="100" max="10000" step="100">
                        </div>
                        <button onclick="computeErgodicCapacity()">Add Curve to Plot</button>
                        <button onclick="clearAllCurves()" style="margin-top: 10px; background-color: #e74c3c;">Clear All Curves</button>
                        <div id="curvesList" style="margin-top: 15px; font-size: 12px;">
                            <strong>Added Curves (0/6):</strong>
                            <div id="curvesContainer" style="margin-top: 5px;"></div>
                        </div>
                    </div>
                    <div class="right-column box" style="flex: 2;">
                        <h3>Ergodic Capacity Plot</h3>
                        <div class="chart-container" style="position: relative; width: 100%; height: 450px;">
                            <!-- Add a backup Y-axis for tiny screens -->
                            <div class="backup-axis" style="position: absolute; left: 10px; top: 30px; bottom: 30px; width: 1px; background: black; z-index: 1; display: none;"></div>
                            <canvas id="ergodicChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    
<script src="./js/main.js"></script>
<script src="https://cdn.jsdelivr.net/gh/virtual-labs/virtual-style@0.0.8-b/js/script.js"></script>
<script>
    // Extra fix for tiny screens
    window.addEventListener('resize', function() {
        const backupAxis = document.querySelector('.backup-axis');
        if (backupAxis) {
            backupAxis.style.display = window.innerWidth <= 290 ? 'block' : 'none';
        }
    });
    
    // Check on load
    window.addEventListener('load', function() {
        const backupAxis = document.querySelector('.backup-axis');
        if (backupAxis) {
            backupAxis.style.display = window.innerWidth <= 290 ? 'block' : 'none';
        }
    });
</script>

</body>
</html>